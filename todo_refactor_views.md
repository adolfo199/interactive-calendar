# Refactorizaci√≥n de Vistas del Calendario - Plan de Trabajo

## Estado Actual del Proyecto
**Rama:** `views-refactor` ‚úÖ  
**√öltima actualizaci√≥n:** 31 de julio de 2025  
**Progreso general:** üü¢ Fase 1 y 2 Completadas | ‚è≥ Fase 3 En Progreso

### ‚úÖ Completado:
- **Fase 1:** Estructura y componentes compartidos (100%)
  - Estructura de carpetas creada
  - 5 componentes compartidos implementados:
    - `AppointmentCard.tsx` - Tarjeta reutilizable con 4 variantes
    - `NavigationControls.tsx` - Controles de navegaci√≥n (full/compact)
    - `ViewSelector.tsx` - Selector de vistas con iconos
    - `TimeSlot.tsx` - Slots de tiempo para day/week
    - `StatusIndicator.tsx` - Indicadores de estado con colores
  - Exportaciones centralizadas configuradas
  - Comentarios en ingl√©s aplicados
  - TypeScript strict mode aplicado

- **Fase 2:** Orquestador principal CalendarMain (100%)
  - Nuevo CalendarMain como orquestador principal creado
  - Sistema de delegaci√≥n de vistas implementado
  - Toolbar global con NavigationControls y ViewSelector
  - Manejo centralizado de eventos y estado
  - Compatibilidad backward mantenida
  - Vista temporal para month hasta Fase 3
  - Integraci√≥n con componentes compartidos

### ‚è≥ En Progreso:
- **Fase 3:** CalendarMonth refactorizaci√≥n (0%)

### üìã Pendiente:
- Fases 4-6: Refactorizaci√≥n de vistas restantes

## Objetivo

Dividir los componentes `CalendarDay`, `CalendarWeek` y `CalendarMain` en subcomponentes m√°s peque√±os y especializados para mejorar la mantenibilidad, reutilizaci√≥n y testeo del c√≥digo.

## Nueva Estructura Propuesta

```
src/
‚îú‚îÄ‚îÄ CalendarMain.tsx                  # üîÑ Orquestador PRINCIPAL de todas las vistas
‚îú‚îÄ‚îÄ calendar-views/
‚îÇ   ‚îú‚îÄ‚îÄ day/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CalendarDay.tsx           # üîÑ Orquestador de vista diaria
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DayHeader.tsx         # ‚ú® Cabecera del d√≠a con navegaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DayTimeSlots.tsx      # ‚ú® Slots de tiempo del d√≠a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DayAppointments.tsx   # ‚ú® Lista de citas del d√≠a
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DayControls.tsx       # ‚ú® Controles de navegaci√≥n espec√≠ficos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                  # ‚ú® Exportaciones limpias
‚îÇ   ‚îú‚îÄ‚îÄ week/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CalendarWeek.tsx          # üîÑ Orquestador de vista semanal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WeekHeader.tsx        # ‚ú® Cabecera de la semana
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WeekGrid.tsx          # ‚ú® Grid de d√≠as de la semana
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WeekDayColumn.tsx     # ‚ú® Columna individual de d√≠a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WeekTimeAxis.tsx      # ‚ú® Eje de tiempo lateral
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WeekControls.tsx      # ‚ú® Controles de navegaci√≥n espec√≠ficos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                  # ‚ú® Exportaciones limpias
‚îÇ   ‚îú‚îÄ‚îÄ month/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CalendarMonth.tsx         # üîÑ Orquestador de vista mensual (antes CalendarMain)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MonthHeader.tsx       # ‚ú® Cabecera del mes con navegaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MonthGrid.tsx         # ‚ú® Grid del calendario mensual
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MonthDay.tsx          # ‚ú® Celda individual de d√≠a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MonthControls.tsx     # ‚ú® Controles de navegaci√≥n espec√≠ficos
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MonthSidebar.tsx      # ‚ú® Panel lateral (opcional)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                  # ‚ú® Exportaciones limpias
‚îÇ   ‚îî‚îÄ‚îÄ shared/
‚îÇ       ‚îú‚îÄ‚îÄ AppointmentCard.tsx       # ‚ú® Tarjeta de cita reutilizable
‚îÇ       ‚îú‚îÄ‚îÄ TimeSlot.tsx              # ‚ú® Slot de tiempo reutilizable
‚îÇ       ‚îú‚îÄ‚îÄ NavigationControls.tsx    # ‚ú® Controles de navegaci√≥n compartidos
‚îÇ       ‚îú‚îÄ‚îÄ ViewSelector.tsx          # ‚ú® Selector de vista (d√≠a/semana/mes)
‚îÇ       ‚îî‚îÄ‚îÄ StatusIndicator.tsx       # ‚ú® Indicador de estado reutilizable
```

## Leyenda
- üîÑ **Refactorizar**: Componente existente que se convierte en orquestador
- ‚ú® **Crear**: Nuevo componente a crear
- üì¶ **Reutilizar**: Componente compartido entre vistas

## An√°lisis de Componentes Actuales

### 1. CalendarMain.tsx (NUEVO ORQUESTADOR PRINCIPAL)
**Nueva responsabilidad:**
- Orquestaci√≥n general del sistema de calendario
- Toolbar principal con navegaci√≥n y controles globales
- Selector de vistas (d√≠a/semana/mes)
- Delegaci√≥n a vistas espec√≠ficas
- Manejo de estados y eventos globales
- Estad√≠sticas y leyenda general

**Estructura propuesta:**
```tsx
// CalendarMain.tsx -> Orquestador PRINCIPAL
‚îú‚îÄ‚îÄ NavigationControls.tsx   # Navegaci√≥n global (shared)
‚îú‚îÄ‚îÄ ViewSelector.tsx         # Selector de vistas (shared)
‚îú‚îÄ‚îÄ CalendarMonth.tsx        # Vista mensual
‚îú‚îÄ‚îÄ CalendarWeek.tsx         # Vista semanal
‚îî‚îÄ‚îÄ CalendarDay.tsx          # Vista diaria
```

### 2. CalendarMonth.tsx (antes CalendarMain)
**Responsabilidades espec√≠ficas:**
- Vista mensual del calendario
- Grid del calendario mensual
- Celdas de d√≠as del mes
- Manejo de eventos mensuales

**Refactorizaci√≥n propuesta:**
```tsx
// CalendarMonth.tsx -> Orquestador mensual (antes CalendarMain)
‚îú‚îÄ‚îÄ MonthHeader.tsx      # Cabecera espec√≠fica del mes
‚îú‚îÄ‚îÄ MonthGrid.tsx        # Grid del calendario mensual
‚îú‚îÄ‚îÄ MonthDay.tsx         # Celda individual de d√≠a
‚îî‚îÄ‚îÄ AppointmentCard.tsx  # Tarjeta de cita (shared)
```

### 3. CalendarWeek.tsx
**Responsabilidades espec√≠ficas:**
- Vista semanal del calendario
- Grid de d√≠as de la semana
- Slots de tiempo semanales
- Manejo de eventos semanales

**Refactorizaci√≥n propuesta:**
```tsx
// CalendarWeek.tsx -> Orquestador semanal
‚îú‚îÄ‚îÄ WeekHeader.tsx       # Cabecera con d√≠as de la semana
‚îú‚îÄ‚îÄ WeekGrid.tsx         # Grid principal de la semana
‚îú‚îÄ‚îÄ WeekDayColumn.tsx    # Columna de d√≠a individual
‚îú‚îÄ‚îÄ WeekTimeAxis.tsx     # Eje lateral de horas
‚îî‚îÄ‚îÄ AppointmentCard.tsx  # Tarjeta de cita (shared)
```

### 4. CalendarDay.tsx
**Responsabilidades espec√≠ficas:**
- Vista diaria del calendario
- Slots de tiempo del d√≠a
- Lista de citas diarias
- Navegaci√≥n diaria

**Refactorizaci√≥n propuesta:**
```tsx
// CalendarDay.tsx -> Orquestador diario
‚îú‚îÄ‚îÄ DayHeader.tsx        # Cabecera del d√≠a
‚îú‚îÄ‚îÄ DayTimeSlots.tsx     # Slots de tiempo
‚îú‚îÄ‚îÄ DayAppointments.tsx  # Lista de citas
‚îî‚îÄ‚îÄ AppointmentCard.tsx  # Tarjeta de cita (shared)
```

## Componentes Compartidos (shared/)

### AppointmentCard.tsx
```tsx
interface AppointmentCardProps {
  event: CalendarEvent
  variant: 'month' | 'week' | 'day' | 'list'
  size: 'sm' | 'md' | 'lg'
  showDetails?: boolean
  onClick?: (event: CalendarEvent) => void
  className?: string
}
```

### TimeSlot.tsx
```tsx
interface TimeSlotProps {
  time: Date
  duration: number // minutos
  events: CalendarEvent[]
  onSlotClick?: (time: Date) => void
  onEventClick?: (event: CalendarEvent) => void
  view: 'day' | 'week'
}
```

### NavigationControls.tsx
```tsx
interface NavigationControlsProps {
  onPrevious: () => void
  onNext: () => void
  onToday: () => void
  title: string
  loading?: boolean
  variant: 'full' | 'compact'
}
```

### ViewSelector.tsx
```tsx
interface ViewSelectorProps {
  currentView: CalendarView
  onViewChange: (view: CalendarView) => void
  availableViews: CalendarView[]
  loading?: boolean
}
```

## Plan de Implementaci√≥n

### Fase 1: Crear estructura y componentes compartidos
1. ‚úÖ Crear carpetas `calendar-views/` y subcarpetas
2. ‚úÖ Crear componentes en `shared/`
3. ‚úÖ Migrar l√≥gica com√∫n a componentes compartidos

### Fase 2: Refactorizar CalendarMain (Orquestador Principal)
1. ‚úÖ Crear nuevo `CalendarMain.tsx` como orquestador principal
2. ‚úÖ Migrar toolbar y controles globales
3. ‚úÖ Implementar delegaci√≥n a vistas espec√≠ficas
4. ‚úÖ Actualizar exportaciones principales

### Fase 3: Refactorizar CalendarMonth (antes CalendarMain)
1. ‚è≥ Renombrar y mover `CalendarMain.tsx` ‚Üí `calendar-views/month/CalendarMonth.tsx`
2. ‚è≥ Crear `MonthHeader.tsx`
3. ‚è≥ Crear `MonthGrid.tsx` 
4. ‚è≥ Crear `MonthDay.tsx`
5. ‚è≥ Refactorizar `CalendarMonth.tsx` como orquestador mensual

### Fase 4: Refactorizar CalendarWeek
1. ‚è≥ Mover `CalendarWeek.tsx` ‚Üí `calendar-views/week/CalendarWeek.tsx`
2. ‚è≥ Crear `WeekHeader.tsx`
3. ‚è≥ Crear `WeekGrid.tsx`
4. ‚è≥ Crear `WeekDayColumn.tsx`
5. ‚è≥ Crear `WeekTimeAxis.tsx`
6. ‚è≥ Refactorizar `CalendarWeek.tsx` como orquestador semanal

### Fase 5: Refactorizar CalendarDay
1. ‚è≥ Mover `CalendarDay.tsx` ‚Üí `calendar-views/day/CalendarDay.tsx`
2. ‚è≥ Crear `DayHeader.tsx`
3. ‚è≥ Crear `DayTimeSlots.tsx`
4. ‚è≥ Crear `DayAppointments.tsx`
5. ‚è≥ Refactorizar `CalendarDay.tsx` como orquestador diario

### Fase 6: Testing y optimizaci√≥n
1. ‚è≥ Tests unitarios para cada componente
2. ‚è≥ Tests de integraci√≥n para orquestadores
3. ‚è≥ Optimizaci√≥n de performance (React.memo, useCallback)
4. ‚è≥ Documentaci√≥n JSDoc

## Migraci√≥n y Compatibilidad

### Cambios de Nombres y Ubicaciones:
```
ANTES:
src/CalendarMain.tsx (570+ l√≠neas)

DESPU√âS:
src/CalendarMain.tsx              # üîÑ NUEVO: Orquestador principal
src/calendar-views/month/CalendarMonth.tsx  # üîÑ RENOMBRADO: Vista mensual espec√≠fica
```

### API P√∫blica:
```tsx
// La API de CalendarMain se mantiene igual para compatibilidad
export function CalendarMain(props: CalendarMainProps) {
  // Internamente delega a CalendarMonth, CalendarWeek, o CalendarDay
  // seg√∫n la vista actual
}

// Nueva exportaci√≥n adicional para uso directo
export { CalendarMonth } from './calendar-views/month'
export { CalendarWeek } from './calendar-views/week'
export { CalendarDay } from './calendar-views/day'
```

## Beneficios Esperados

### üéØ **Mantenibilidad**
- Archivos m√°s peque√±os y enfocados
- Responsabilidades claras y separadas
- M√°s f√°cil debuggear y modificar

### üîÑ **Reutilizaci√≥n**
- Componentes compartidos entre vistas
- Menos duplicaci√≥n de c√≥digo
- Consistencia visual entre vistas

### üß™ **Testing**
- Tests m√°s espec√≠ficos y r√°pidos
- Mockeo m√°s simple
- Mejor cobertura de c√≥digo

### ‚ö° **Performance**
- Mejor optimizaci√≥n con React.memo
- Re-renders m√°s espec√≠ficos
- Lazy loading de componentes

### üë• **Colaboraci√≥n**
- M√∫ltiples desarrolladores trabajando en paralelo
- Merge conflicts reducidos
- Onboarding m√°s simple

## Criterios de √âxito

- [ ] Todos los tests existentes siguen pasando
- [ ] No hay regresiones en funcionalidad
- [ ] Cada archivo tiene menos de 200 l√≠neas
- [ ] Cobertura de tests >= 80%
- [ ] Performance igual o mejor
- [ ] Documentaci√≥n JSDoc completa

## Notas Importantes

### üö® **Mantener Compatibilidad**
- La API p√∫blica de los componentes principales no debe cambiar
- Los props existentes deben seguir funcionando
- Backward compatibility con versiones anteriores

### üìù **Convenciones de C√≥digo**
- Usar TypeScript strict mode
- Props interfaces bien definidas
- Consistent naming conventions
- JSDoc para componentes complejos

### üé® **Dise√±o**
- Mantener el sistema de colores actual
- Preservar las animaciones y transiciones
- Responsive design en todos los subcomponentes

### üåê **Internacionalizaci√≥n**
- Todos los subcomponentes deben soportar i18n
- Usar `useCalendarTranslations` hook
- Mantener soporte para locale prop

## Checklist de Refactorizaci√≥n

### Antes de empezar
- [x] Crear rama `views-refactor`
- [x] Backup de componentes actuales
- [x] Configurar estructura de carpetas

### Durante la refactorizaci√≥n
- [x] Mantener tests corriendo
- [x] Commits frecuentes y descriptivos
- [ ] Revisar performance en cada paso
- [ ] Validar i18n en cada componente

### Al finalizar
- [ ] Todos los tests pasan
- [ ] Build sin errores
- [ ] Demo funcional en proyecto de pruebas
- [ ] Documentaci√≥n actualizada
- [ ] Merge a develop

---

**Creado:** 31 de julio de 2025  
**Objetivo:** Mejorar la arquitectura y mantenibilidad del sistema de vistas del calendario
